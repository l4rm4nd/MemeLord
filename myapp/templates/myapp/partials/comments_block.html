{# Updated comments block with modern styling and AJAX support #}
<div class="comments-container">
  {% for comment in comments_page %}
    <div class="comment-item" data-comment-id="{{ comment.pk }}">
      <div class="comment-header">
        <div class="comment-author">
          <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16" class="me-1">
            <path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0zm4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4zm-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10c-2.29 0-3.516.68-4.168 1.332-.678.678-.83 1.418-.832 1.664h10z"/>
          </svg>
          <strong>{{ comment.author }}</strong>
        </div>
        <div class="comment-meta">
          <small class="text-muted">
            {{ comment.created_at|date:"Y-m-d H:i" }}
          </small>
          {% if request.user == comment.author or request.user.is_superuser %}
            <button type="button"
                    class="btn btn-sm btn-link text-danger p-0 ms-2"
                    data-comment-delete="{{ comment.pk }}"
                    data-delete-url="{% url 'myapp:comment_delete' comment.pk %}">
              <svg width="14" height="14" fill="currentColor" viewBox="0 0 16 16">
                <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>
                <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>
              </svg>
            </button>
          {% endif %}
        </div>
      </div>
      <div class="comment-text">
        {{ comment.text|linebreaksbr }}
      </div>
    </div>
  {% empty %}
    <div class="text-center text-muted py-5">
      <svg width="48" height="48" fill="currentColor" viewBox="0 0 16 16" style="opacity: 0.3;">
        <path d="M2.678 11.894a1 1 0 0 1 .287.801 10.97 10.97 0 0 1-.398 2c1.395-.323 2.247-.697 2.634-.893a1 1 0 0 1 .71-.074A8.06 8.06 0 0 0 8 14c3.996 0 7-2.807 7-6 0-3.192-3.004-6-7-6S1 4.808 1 8c0 1.468.617 2.83 1.678 3.894zm-.493 3.905a21.682 21.682 0 0 1-.713.129c-.2.032-.352-.176-.273-.362a9.68 9.68 0 0 0 .244-.637l.003-.01c.248-.72.45-1.548.524-2.319C.743 11.37 0 9.76 0 8c0-3.866 3.582-7 8-7s8 3.134 8 7-3.582 7-8 7a9.06 9.06 0 0 1-2.347-.306c-.52.263-1.639.742-3.468 1.105z"/>
      </svg>
      <p class="mt-3 mb-0">No comments yet. Start the discussion!</p>
    </div>
  {% endfor %}
</div>

{% if comments_page.paginator.num_pages > 1 %}
  <div class="comments-pagination">
    {% if comments_page.has_previous %}
      <a href="?cpage={{ comments_page.previous_page_number }}#comments"
         class="btn btn-sm btn-outline-secondary"
         data-comments-page="{{ comments_page.previous_page_number }}">
        <svg width="14" height="14" fill="currentColor" viewBox="0 0 16 16">
          <path fill-rule="evenodd" d="M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z"/>
        </svg>
        Previous
      </a>
    {% else %}
      <button class="btn btn-sm btn-outline-secondary" disabled>Previous</button>
    {% endif %}

    <span class="text-muted small">
      {{ comments_page.start_index }}â€“{{ comments_page.end_index }}
      of {{ comments_page.paginator.count }}
    </span>

    {% if comments_page.has_next %}
      <a href="?cpage={{ comments_page.next_page_number }}#comments"
         class="btn btn-sm btn-outline-secondary"
         data-comments-page="{{ comments_page.next_page_number }}">
        Next
        <svg width="14" height="14" fill="currentColor" viewBox="0 0 16 16">
          <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"/>
        </svg>
      </a>
    {% else %}
      <button class="btn btn-sm btn-outline-secondary" disabled>Next</button>
    {% endif %}
  </div>
{% endif %}

<style>
  .comments-container {
    display: flex;
    flex-direction: column;
    gap: 16px;
  }

  .comment-item {
    padding: 16px;
    background: var(--bs-secondary-bg);
    border: 1px solid var(--bs-border-color);
    border-radius: 8px;
    transition: all 0.3s ease;
  }

  .comment-item:hover {
    border-color: var(--bs-primary);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
  }

  .comment-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
  }

  .comment-author {
    display: flex;
    align-items: center;
    font-size: 0.95rem;
  }

  .comment-meta {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .comment-text {
    color: var(--bs-body-color);
    line-height: 1.6;
    word-wrap: break-word;
  }

  .comments-pagination {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 16px 0;
    margin-top: 16px;
    border-top: 1px solid var(--bs-border-color);
  }

  .comments-pagination .btn {
    display: inline-flex;
    align-items: center;
    gap: 4px;
  }

  @media (max-width: 576px) {
    .comment-item {
      padding: 12px;
    }

    .comment-header {
      flex-direction: column;
      align-items: flex-start;
      gap: 6px;
    }
  }
</style>
